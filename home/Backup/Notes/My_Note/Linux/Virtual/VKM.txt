Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2011-11-02T14:55:36+08:00

====== KVM ======

创建镜像文件
qemu-img create -f qcow2 winxp.img 4G


安装
kvm -m 512 -smp 1 -vga std -localtime -boot d -cdrom Deepin-Lite-XP.iso -drive file=/home/havanna/VirtualBox\ VMs/kvmxp/winxp.img,cache=writeback

装驱动，先下载virtio-win-1.1.16.iso
qemu-img create -f qcow2 fake.img 1G
kvm -m 512 -smp 1 -vga std -localtime -drive file=/home/havanna/VirtualBox\ VMs/kvmxp/winxp.img,cache=writeback,if=ide,boot=on -drive file=fake.img,if=virtio -net nic,model=virtio -net user -usb -usbdevice tablet -cdrom /home/havanna/Backup/iso/virtio-win-1.1.16.iso

正常启动
kvm -m 512 -smp 1 -vga std -localtime -usb -usbdevice tablet -soundhw es1370 -drive file=/home/havanna/VirtualBox\ VMs/kvmxp/winxp.img,cache=writeback,if=virtio,boot=on -net nic,model=virtio -net user

如果正常启动还需要装驱动的话
kvm -m 512 -smp 1 -vga std -localtime -usb -usbdevice tablet -soundhw es1370 -drive file=/home/havanna/VirtualBox\ VMs/kvmxp/winxp.img,cache=writeback,if=virtio,boot=on -net nic,model=virtio -net user -cdrom /home/havanna/Backup/iso/virtio-win-1.1.16.iso -boot c

daemon运行及rdesktop连接
kvm -m 512 -smp 1 -vga std -localtime -usb -usbdevice tablet -soundhw es1370 -drive file=/home/havanna/VirtualBox\ VMs/kvmxp/winxp.img,cache=writeback,if=virtio,boot=on -net nic,model=virtio -net user -vnc 127.0.0.1:0 -daemonize -redir tcp:3389::3389 -smb qemu -name "Windows XP"

rdesktop localhost:3389:3389 -u virtio -g 1024×600 -D -r sound:remote -z -r disk:Public=/home/havanna/Public -clipboard


(qemu) info block
(qemu) eject
(qemu) change





Mac OSX
kvm -M mac -kernel ~/kvm-osx-bootloader/boot -usb -usbdevice mouse -usbdevice keyboard -hda $MY_DISK_IMAGE_FILE -cdrom /dev/cdrom -m 512 -osk $HARDWARE_KEY -serial stdio




手动给usb权限
$ lsusb
Bus 001 Device 006: ID 022c:a330 Netac Technology Co., Ltd 
sudo chown user:user /dev/bus/usb/001/006
或者
vi /etc/udev/rules.d/60-usb-plugdev.rules
SUBSYSTEM=="usb_device", GROUP="plugdev", MODE="0664"
SUBSYSTEM=="usb", DRIVERS=="usb", GROUP="users", MODE="0666"
